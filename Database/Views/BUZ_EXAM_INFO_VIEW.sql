CREATE OR REPLACE FORCE VIEW BUZ_EXAM_INFO_VIEW AS
SELECT  case when HASH is not null and HASH=GenerateSHA1(ID||SUBJECT||BOOKING_ID||EXAM_START_TIME||EXAM_END_TIME||CURRENT_EXAM_TIMES||CURRENT_EXAM_SCORE||EXAM_STATUS||CONTRAIL_PATH||VIDEO_PATH) then 'TRUE' else 'FALSE' end VERIFY,
        ID,
        (select DICT_NAME from CFG_DICT where DICT_TYPE=1006 and DICT_CODE=SUBJECT) SUBJECT_DICT_NAME,
		(select NAME from BAS_STUDENT where ID=(select STUDENT_ID from BAS_BOOKING where ID=BOOKING_ID)) STUDENT_NAME,
		(select IDNUMBER from BAS_STUDENT where ID=(select STUDENT_ID from BAS_BOOKING where ID=BOOKING_ID)) STUDENT_IDNUMBER,
		(select DICT_NAME from CFG_DICT where DICT_TYPE=2001 and DICT_CODE=(select GENDER from BAS_STUDENT where ID=(select STUDENT_ID from BAS_BOOKING where ID=BOOKING_ID))) STUDENT_GENDER,
        (select DICT_NAME from CFG_DICT where DICT_TYPE=1036 and DICT_CODE=(select STATUS from BAS_STUDENT where ID=(select STUDENT_ID from BAS_BOOKING where ID=BOOKING_ID))) STUDENT_STATUS,
		(select DRIVER_LICENSE_TYPE from BAS_BOOKING where ID=BOOKING_ID) DRIVER_LICENSE_TYPE,
		(select SEQUENCENUMBER from BAS_BOOKING where ID=BOOKING_ID) BOOKING_SEQUENCENUMBER,
		(select EXAMNUMBER from BAS_BOOKING where ID=BOOKING_ID) EXAM_NUMBER,
		(select DICT_NAME from CFG_DICT where DICT_TYPE=1007 and DICT_CODE=(select EXAM_REASON from BAS_BOOKING where ID=BOOKING_ID)) EXAM_REASON,
		(select EXAM_DATE from BAS_BOOKING where ID=BOOKING_ID) EXAM_DATE,
		(select BOOKING_TIMES from BAS_BOOKING where ID=BOOKING_ID) BOOKING_TIMES,
		(select EXAM_TIMES from BAS_BOOKING where ID=BOOKING_ID) EXAM_TIMES,
		(select EXAM_SESSION from BAS_BOOKING where ID=BOOKING_ID) EXAM_SESSION,
		(select NAME from BAS_PLACE where ID=(select PLACE_ID from BAS_BOOKING where ID=BOOKING_ID)) PLACE_NAME,
		(select SEQUENCENUMBER from BAS_PLACE where ID=(select PLACE_ID from BAS_BOOKING where ID=BOOKING_ID)) PLACE_SEQUENCENUMBER,
        (select CARNUMBER from BAS_CAR where ID=(select CAR_ID from BAS_BOOKING where ID=BOOKING_ID)) CARNUMBER,
        (select SEQUENCENUMBER from BAS_CAR where ID=(select CAR_ID from BAS_BOOKING where ID=BOOKING_ID)) CARSEQUENCENUMBER,
		(select DICT_NAME from CFG_DICT where DICT_TYPE=2004 and DICT_CODE=(select CAR_TYPE from BAS_CAR where ID=(select CAR_ID from BAS_BOOKING where ID=BOOKING_ID))) CAR_TYPE,
        (select LICENSE_PLATE from BAS_CAR where ID=(select CAR_ID from BAS_BOOKING where ID=BOOKING_ID)) LICENSE_PLATE,
		(select NAME from BAS_EXAMINER where ID=(select EXAMINER1_ID from BAS_BOOKING where ID=BOOKING_ID)) EXAMINER1_NAME,
		(select NAME from BAS_EXAMINER where ID=(select EXAMINER2_ID from BAS_BOOKING where ID=BOOKING_ID)) EXAMINER2_NAME,
		(select NAME from BAS_DRIVING_SCHOOL where ID=(select SCHOOL_ID from BAS_BOOKING where ID=BOOKING_ID)) SCHOOL_NAME,
        EXAM_START_TIME,
        EXAM_END_TIME,
		CURRENT_EXAM_TIMES,
        CURRENT_EXAM_SCORE,
		(select DICT_NAME from CFG_DICT where DICT_TYPE=1008 and DICT_CODE=EXAM_STATUS) EXAM_STATUS_DICT_NAME,
		(select count(*) from BUZ_EXAM_PROCESS where EXAM_ID=BUZ_EXAM_INFO.ID and DEDUCT_ITEM is not NULL) DEDUCT_COUNT,
		(select sum(DEDUCT_SCORE) from BUZ_EXAM_PROCESS where EXAM_ID=BUZ_EXAM_INFO.ID and DEDUCT_ITEM is not NULL) DEDUCT_SCORE
FROM BUZ_EXAM_INFO
ORDER BY ID;
